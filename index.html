<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini App Inversi贸n TON</title>

<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f2f5f9;
}

.container{
    max-width:500px;
    margin:auto;
    padding:15px;
}

h2{
    text-align:center;
}

.balance-box{
    background:white;
    padding:15px;
    border-radius:15px;
    text-align:center;
    margin:15px 0;
    font-size:18px;
    font-weight:bold;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
}

.grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
}

.card{
    background:white;
    border-radius:18px;
    padding:20px;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.08);
    cursor:pointer;
    transition:0.2s;
}

.card:hover{
    transform:scale(1.05);
}

.icon{
    font-size:35px;
    margin-bottom:8px;
}

.full{
    grid-column: span 2;
}

.hidden{
    display:none;
}

input{
    width:100%;
    padding:10px;
    margin-top:10px;
    border-radius:8px;
    border:1px solid #ccc;
}

button{
    width:100%;
    padding:10px;
    margin-top:10px;
    border:none;
    border-radius:8px;
    background:#0088cc;
    color:white;
    font-weight:bold;
}
</style>
</head>
<body>

<div class="container">

<h2>Panel Inversi贸n TON</h2>

<div id="ton-connect"></div>

<div class="balance-box">
Saldo Disponible: <span id="balance">0</span> TON
</div>

<div class="grid">

<div class="card" onclick="connectWallet()">
<div class="icon"></div>
Conectar Wallet
</div>

<div class="card" onclick="showDeposit()">
<div class="icon"></div>
Depositar
</div>

<div class="card" onclick="showPlans()">
<div class="icon"></div>
Planes
</div>

<div class="card" onclick="showWithdraw()">
<div class="icon"></div>
Retirar
</div>

<div class="card" onclick="showHistory()">
<div class="icon"></div>
Historial
</div>

<div class="card full" onclick="showSupport()">
<div class="icon"></div>
Soporte
</div>

</div>

<!-- SECCIONES -->

<div id="depositSection" class="hidden">
<h3>Depositar TON</h3>
<input type="number" id="depositAmount" placeholder="Cantidad en TON">
<button onclick="deposit()">Enviar Dep贸sito</button>
</div>

<div id="withdrawSection" class="hidden">
<h3>Retirar TON</h3>
<input type="number" id="withdrawAmount" placeholder="Cantidad a retirar">
<button onclick="withdraw()">Solicitar Retiro</button>
</div>

<div id="plansSection" class="hidden">
<h3>Planes de Inversi贸n</h3>
<button onclick="activatePlan(5)">Plan B谩sico 5% mensual</button>
<button onclick="activatePlan(8)">Plan Pro 8% mensual</button>
<button onclick="activatePlan(12)">Plan Elite 12% mensual</button>
</div>

<div id="historySection" class="hidden">
<h3>Historial</h3>
<ul id="historyList"></ul>
</div>

<div id="supportSection" class="hidden">
<h3>Soporte</h3>
<p>Contacto Telegram: @MANDON1</p>
</div>

</div>

<script>
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: 'https://your-domain.com/tonconnect-manifest.json',
    buttonRootId: 'ton-connect'
});

let balance = localStorage.getItem("balance") ? parseFloat(localStorage.getItem("balance")) : 0;
let history = JSON.parse(localStorage.getItem("history")) || [];
let activePlan = JSON.parse(localStorage.getItem("plan")) || null;

function saveData(){
    localStorage.setItem("balance", balance);
    localStorage.setItem("history", JSON.stringify(history));
    localStorage.setItem("plan", JSON.stringify(activePlan));
}

function updateBalance(){
    document.getElementById("balance").innerText = balance.toFixed(2);
}

function addHistory(text){
    history.push(text);
    saveData();
    renderHistory();
}

function renderHistory(){
    const list = document.getElementById("historyList");
    list.innerHTML = "";
    history.forEach(item=>{
        const li = document.createElement("li");
        li.innerText = item;
        list.appendChild(li);
    });
}

function connectWallet(){
    tonConnectUI.openModal();
}

function hideAll(){
    document.querySelectorAll("#depositSection,#withdrawSection,#plansSection,#historySection,#supportSection")
    .forEach(el=>el.classList.add("hidden"));
}

function showDeposit(){ hideAll(); document.getElementById("depositSection").classList.remove("hidden"); }
function showWithdraw(){ hideAll(); document.getElementById("withdrawSection").classList.remove("hidden"); }
function showPlans(){ hideAll(); document.getElementById("plansSection").classList.remove("hidden"); }
function showHistory(){ hideAll(); document.getElementById("historySection").classList.remove("hidden"); }
function showSupport(){ hideAll(); document.getElementById("supportSection").classList.remove("hidden"); }

async function deposit(){
    const amount = parseFloat(document.getElementById("depositAmount").value);
    if(!amount || amount <= 0) return alert("Cantidad inv谩lida");

    const transaction = {
        validUntil: Math.floor(Date.now() / 1000) + 600,
        messages: [{
            address: "UQC_bn7pmX48L4cwHyR8xykM_PK34zNXQdQ0cgE6FCwGi59J",
            amount: (amount * 1000000000).toString()
        }]
    };

    await tonConnectUI.sendTransaction(transaction);

    balance += amount;
    addHistory("Dep贸sito: " + amount + " TON");
    updateBalance();
    saveData();
}

function withdraw(){
    const amount = parseFloat(document.getElementById("withdrawAmount").value);
    if(!amount || amount <= 0) return alert("Cantidad inv谩lida");
    if(amount > balance) return alert("Saldo insuficiente");

    balance -= amount;
    addHistory("Retiro solicitado: " + amount + " TON");
    updateBalance();
    saveData();
}

function activatePlan(percent){
    if(balance <= 0) return alert("Necesitas saldo para activar un plan");

    activePlan = {
        percent: percent,
        start: Date.now()
    };

    addHistory("Plan activado: " + percent + "% mensual");
    saveData();
}

function calculateProfit(){
    if(!activePlan) return;

    const now = Date.now();
    const diffDays = (now - activePlan.start) / (1000 * 60 * 60 * 24);

    const monthlyRate = activePlan.percent / 100;
    const dailyRate = monthlyRate / 30;

    const profit = balance * dailyRate * diffDays;

    if(profit > 0){
        balance += profit;
        activePlan.start = now;
        addHistory("Ganancia generada: " + profit.toFixed(4) + " TON");
        updateBalance();
        saveData();
    }
}

setInterval(calculateProfit, 10000);

updateBalance();
renderHistory();
</script>

</body>
</html>
