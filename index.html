<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAN Capital</title>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0B0F1A;color:white;}
.container{max-width:420px;margin:auto;padding:20px;}
.card{background:#121826;padding:20px;border-radius:16px;margin-bottom:15px;}
button{width:100%;padding:14px;border:none;border-radius:10px;margin-bottom:10px;font-weight:bold;cursor:pointer;}
.btn-blue{background:#3B82F6;color:white;}
.btn-green{background:#22C55E;color:white;}
.btn-red{background:#EF4444;color:white;}
input{width:100%;padding:12px;border-radius:10px;border:none;margin-bottom:10px;background:#1E293B;color:white;}
</style>
</head>

<body>

<div class="container">

<div class="card">
<div id="walletText">Wallet no conectada</div>
<button class="btn-blue" id="connectWallet">Conectar Wallet</button>
</div>

<div class="card">
<div>Balance TON: <span id="ton">0</span></div>
<div>Balance PAN: <span id="pan">0</span></div>
</div>

<div class="card">
<input type="number" id="amount" placeholder="Monto TON">

<button class="btn-blue" onclick="deposit()">Depositar</button>
<button class="btn-green" onclick="activate()">Activar Plan</button>
<button class="btn-red" onclick="withdraw()">Retirar</button>
</div>

</div>

<script>
const API = "http://localhost:3000/api/user";
let currentWallet = null;

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
manifestUrl: 'https://ton-connect.github.io/demo-dapp-with-react-ui/tonconnect-manifest.json',
buttonRootId: 'connectWallet'
});

tonConnectUI.onStatusChange(async wallet => {
if(wallet){
currentWallet = wallet.account.address;
document.getElementById("walletText").innerText = currentWallet;
await fetch(API+"/connect",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({wallet:currentWallet})
});
loadUser();
}
});

async function loadUser(){
const res = await fetch(API+"/"+currentWallet);
const data = await res.json();
document.getElementById("ton").innerText = data.tonBalance;
document.getElementById("pan").innerText = data.panBalance;
}

async function deposit(){
const amount = parseFloat(document.getElementById("amount").value);
await fetch(API+"/deposit",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({wallet:currentWallet,amount})
});
loadUser();
}

async function activate(){
await fetch(API+"/activate",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({wallet:currentWallet})
});
loadUser();
}

async function withdraw(){
const amount = parseFloat(prompt("Monto a retirar"));
await fetch(API+"/withdraw",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({wallet:currentWallet,amount})
});
loadUser();
}
</script>

</body>
</html>
