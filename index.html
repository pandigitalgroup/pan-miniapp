<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>$PAN Ecosystem</title>

<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

<style>
body{
    margin:0;
    font-family:'Segoe UI', sans-serif;
    background:linear-gradient(135deg,#0f172a,#1e293b);
    color:white;
}

.container{
    max-width:500px;
    margin:auto;
    padding:20px;
}

h2{
    text-align:center;
    margin-bottom:15px;
    font-weight:600;
}

.balance-box{
    background:#1e293b;
    padding:15px;
    border-radius:15px;
    margin:10px 0;
    text-align:center;
    box-shadow:0 4px 15px rgba(0,0,0,0.4);
}

.balance-box span{
    font-size:20px;
    font-weight:bold;
    color:#38bdf8;
}

.grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
    margin-top:20px;
}

.card{
    border-radius:18px;
    padding:18px;
    text-align:center;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
    box-shadow:0 4px 15px rgba(0,0,0,0.4);
}

.card:hover{
    transform:scale(1.05);
}

.full{
    grid-column:span 2;
}

/* COLORES PROFESIONALES */

.connect{background:#2563eb;}
.deposit{background:#16a34a;}
.plan{background:#f59e0b;}
.claim{background:#9333ea;}
.history{background:#334155;}

.hidden{display:none;}

.section-box{
    background:#1e293b;
    padding:15px;
    border-radius:15px;
    margin-top:15px;
}

input{
    width:100%;
    padding:10px;
    margin-top:10px;
    border-radius:8px;
    border:none;
}

button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border:none;
    border-radius:10px;
    background:#38bdf8;
    color:black;
    font-weight:bold;
    cursor:pointer;
}

button:hover{
    background:#0ea5e9;
}
</style>
</head>
<body>

<div class="container">

<h2>$PAN Ecosystem</h2>

<div id="ton-connect"></div>

<div class="balance-box">
TON Invertido:<br>
<span id="tonBalance">0</span> TON
</div>

<div class="balance-box">
$PAN Acumulado:<br>
<span id="panBalance">0</span> PAN
</div>

<div class="grid">
<div class="card connect" onclick="connectWallet()">ðŸ”— Conectar</div>
<div class="card deposit" onclick="showDeposit()">ðŸ’° Depositar</div>
<div class="card plan" onclick="showStake()">ðŸ“ˆ Activar Plan</div>
<div class="card claim" onclick="showClaim()">ðŸª™ Reclamar PAN</div>
<div class="card history full" onclick="showHistory()">ðŸ“œ Historial</div>
</div>

<div id="depositSection" class="section-box hidden">
<h3>Depositar TON</h3>
<input type="number" id="depositAmount" placeholder="Cantidad TON">
<button onclick="deposit()">Enviar DepÃ³sito</button>
</div>

<div id="stakeSection" class="section-box hidden">
<h3>Plan Activo 6% mensual</h3>
<button onclick="activatePlan()">Activar Plan</button>
</div>

<div id="claimSection" class="section-box hidden">
<h3>Reclamar $PAN acumulado</h3>
<button onclick="claimPAN()">Reclamar PAN</button>
</div>

<div id="historySection" class="section-box hidden">
<h3>Historial</h3>
<ul id="historyList"></ul>
</div>

</div>

<script>

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: 'https://your-domain.com/tonconnect-manifest.json',
    buttonRootId: 'ton-connect'
});

let tonBalance = localStorage.getItem("tonBalance") ? parseFloat(localStorage.getItem("tonBalance")) : 0;
let panBalance = localStorage.getItem("panBalance") ? parseFloat(localStorage.getItem("panBalance")) : 0;
let planActive = localStorage.getItem("planActive") === "true";
let lastRewardTime = localStorage.getItem("lastRewardTime") ? parseInt(localStorage.getItem("lastRewardTime")) : Date.now();
let history = JSON.parse(localStorage.getItem("history")) || [];

function saveData(){
    localStorage.setItem("tonBalance", tonBalance);
    localStorage.setItem("panBalance", panBalance);
    localStorage.setItem("planActive", planActive);
    localStorage.setItem("lastRewardTime", lastRewardTime);
    localStorage.setItem("history", JSON.stringify(history));
}

function updateUI(){
    document.getElementById("tonBalance").innerText = tonBalance.toFixed(2);
    document.getElementById("panBalance").innerText = panBalance.toFixed(2);
    renderHistory();
}

function addHistory(text){
    history.push(text);
    saveData();
}

function renderHistory(){
    const list = document.getElementById("historyList");
    list.innerHTML="";
    history.forEach(item=>{
        const li=document.createElement("li");
        li.innerText=item;
        list.appendChild(li);
    });
}

function connectWallet(){
    tonConnectUI.openModal();
}

function hideAll(){
    document.querySelectorAll("#depositSection,#stakeSection,#claimSection,#historySection")
    .forEach(el=>el.classList.add("hidden"));
}

function showDeposit(){hideAll();document.getElementById("depositSection").classList.remove("hidden");}
function showStake(){hideAll();document.getElementById("stakeSection").classList.remove("hidden");}
function showClaim(){hideAll();document.getElementById("claimSection").classList.remove("hidden");}
function showHistory(){hideAll();document.getElementById("historySection").classList.remove("hidden");}

async function deposit(){
    const amount=parseFloat(document.getElementById("depositAmount").value);
    if(!amount||amount<=0)return alert("Cantidad invÃ¡lida");

    const transaction={
        validUntil:Math.floor(Date.now()/1000)+600,
        messages:[{
            address:"UQC_bn7pmX48L4cwHyR8xykM_PK34zNXQdQ0cgE6FCwGi59J",
            amount:(amount*1000000000).toString()
        }]
    };

    await tonConnectUI.sendTransaction(transaction);

    tonBalance+=amount;
    addHistory("DepÃ³sito TON: "+amount);
    saveData();
    updateUI();
}

function activatePlan(){
    if(tonBalance<=0)return alert("Necesitas TON invertido");
    planActive=true;
    lastRewardTime=Date.now();
    addHistory("Plan activado");
    saveData();
}

function calculateRewards(){
    if(!planActive)return;

    const now=Date.now();
    const diffDays=(now-lastRewardTime)/(1000*60*60*24);

    const monthlyPAN=0.03;
    const dailyPAN=monthlyPAN/30;

    const reward=tonBalance*dailyPAN*diffDays;

    if(reward>0){
        panBalance+=reward;
        lastRewardTime=now;
        saveData();
        updateUI();
    }
}

function claimPAN(){
    if(panBalance<=0)return alert("No tienes PAN acumulado");
    addHistory("Reclamado PAN interno: "+panBalance.toFixed(2));
    alert("PAN acreditado internamente");
}

setInterval(calculateRewards,10000);
updateUI();

</script>

</body>
</html>
